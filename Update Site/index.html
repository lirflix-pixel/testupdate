<!DOCTYPE html>
<html lang="fr">
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta charset="UTF-8">
  <title>LirFlix ‚Äì Accueil</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
  <style>
    body {
      overflow-x: hidden; /* Emp√™che le scroll horizontal */
    }

    .ad-banner {
      width: 100%;
      display: flex;
      justify-content: center;
      overflow-x: auto;
      padding: 10px 0;
    }

    .ad-banner iframe {
      max-width: 100%;
      height: auto;
    }
    .ad-container {
      display: flex;
      justify-content: center;
      overflow: hidden;
      padding: 16px 0;
      width: 100%;
      }

    .ad-container iframe {
      max-width: 100%;
      height: auto;
      display: block;
    }

  </style>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-7GT1SW7HBT"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-7GT1SW7HBT');
  </script>
  <!-- Google Tag Manager -->
  <script>
    (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-M9FPTMTQ');
  </script>
</head>
<body>
  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-M9FPTMTQ"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager -->

<header class="header-xmas">
  <img src="images/lirflixnoel.png" alt="Lirflix Noel" id="logo-noel">
</header>

  <!-- FILTRES -->
  <nav class="navbar">
    <ul id="filters">
      <li><button class="filter-btn active" data-filter="all">Toutes</button></li>
      <li><button class="filter-btn" data-filter="W9">W9</button></li>
      <li><button class="filter-btn" data-filter="M6">M6</button></li>
      <li><button class="filter-btn" data-filter="TF1">TF1</button></li>
    </ul>
  </nav>

  <!-- √âMISSIONS -->
  <div class="emissions">
    <a class="card" href="emissions/emission9" data-chaine="W9"data-slug="the_cerveau">
      <img src="images/cerveau.jpg" alt="The Cerveau">
      <h2>The Cerveau S2</h2>
      <p>Qui sera le plus grand cerveau de la t√©l√© r√©alit√© ? Saison 2.</p>
    </a>

    <a class="card" href="emissions/emission10.html" data-chaine="TF1"data-slug="la_bataille">
      <img src="images/bataille1.jpg" alt="La Mal√©diction de l'√Æle maudite">
      <h2>La Mal√©diction de l'√Æle</h2>
      <p>10 duos, une √Æle myst√©rieuse et impitoyable.</p>
    </a>

        <a class="card" href="emission.html" data-chaine="M6"data-slug="pekin_express">
      <img src="images/express.jpg" alt="P√©kin Express">
      <h2>P√©kin Express</h2>
      <p>Cette saison se passe pour la premi√®re fois au Kazakhstan et pour la premi√®re fois dans un pays froid.</p>
    </a>

      <a class="card" href="emissions/emission12" data-chaine="W9" data-slug="cest-la-famille">
      <div class="image-wrapper">
      <img src="images/clafamille.jpeg" alt="C'est la famille">
       <div class="badge-nouveau">Nouveau üî•</div>
      </div> 
      <h2>C'est la famille</h2>
      <p>L'√©mission qui suit le quotidien des familles issues de la t√©l√©r√©alit√©.</p>
    </a>

     <a class="card" href="emissions/emission8" data-chaine="M6" data-slug="lamour-est-dans-le-pre">
      <img src="images/adlp.jpg" alt="L'amour est dans le pr√©">
      <h2>L'amour est dans le pr√©</h2>
      <p>Des agriculteurs en qu√™te d'amour ouvrent leur coeur devant les cam√©ras.</p>
    </a>

    <a class="card" href="emissions/emission5" data-chaine="TF1" data-slug="plus-belle-la-vie">
      <img src="images/plb.jpg" alt="Plus Belle La Vie">
      <h2>Plus Belle La Vie</h2>
      <p>Le quotidien des habitants du quartier fictif du Mistral √† Marseille.</p>
    </a>

    <a class="card" href="emissions/emission1" data-chaine="TF1" data-slug="itc">
      <img src="images/ici_tout_commence.jpg" alt="Ici tout commence">
      <h2>Ici tout commence</h2>
      <p>Plongez dans l‚Äôunivers culinaire de l‚Äôinstitut.</p>
    </a>
</div>
<footer class="footer-split">
  <div class="footer-left">
    <h3>Retrouvez nous sur :</h3>

    <a href="https://www.instagram.com/lirflixx/" target="_blank" class="footer-social">
      Instagram
    </a>

    <a href="https://t.me/+aGHWx8C_R8FiNzc0" target="_blank" class="footer-social">
      Telegram
    </a>
  </div>

  <div class="footer-right">
    <p>
      Lirflix.net n'h√©berge aucun fichier vid√©o sur ses serveurs ; la plateforme se limite √† indexer des liens vers des vid√©os
      dont l'h√©bergement est assur√© par des services publics et l√©gaux.
    </p>
  </div>
</footer>
<script>
document.addEventListener('DOMContentLoaded', async () => {
  try {
    const API = '/.netlify/functions/stats';
    const res = await fetch(`${API}?action=top&n=6&_=${Date.now()}`, { cache: 'no-store' });
    const data = await res.json();
    const top = (data.top || []).map(x => (x.slug || '').toLowerCase());

    // Nettoyer d'anciens badges
    document.querySelectorAll('.badge-top-1,.badge-top-2,.badge-top-3').forEach(n => n.remove());

    // Associer slug -> card pr√©sentes dans la page
    const bySlug = new Map(
      [...document.querySelectorAll('.card[data-slug]')]
        .map(card => [card.getAttribute('data-slug').toLowerCase(), card])
    );

    // Poser les badges en re-rankant 1..3 uniquement sur les cartes existantes
    let rank = 0;
    for (const slug of top) {
      const card = bySlug.get(slug);
      if (!card) continue;     // si la carte n'existe pas, on saute
      rank += 1;

      const b = document.createElement('div');
      b.className = `badge-top-${rank}`;
      b.textContent = (rank === 1) ? 'Tendance üî•' : `Top ${rank}`;
      card.appendChild(b);

      if (rank === 3) break;
    }
  } catch (e) {
    console.warn('TOP fail', e);
  }
});

const API='/.netlify/functions/stats';

document.addEventListener('click', (e)=>{
  const a = e.target.closest('.card[data-slug]');
  if (!a) return;

  const slug = a.getAttribute('data-slug');
  const url  = `${API}?action=click&slug=${encodeURIComponent(slug)}`;

  // Fire-and-forget : marche m√™me si la page change
  if (navigator.sendBeacon) {
    const blob = new Blob([], { type: 'text/plain' });
    navigator.sendBeacon(url, blob);
  } else {
    fetch(url, { keepalive: true, cache: 'no-store' }).catch(()=>{});
  }
});
</script>
<script>(function(s){s.dataset.zone='10240220',s.src='https://gizokraijaw.net/vignette.min.js'})([document.documentElement, document.body].filter(Boolean).pop().appendChild(document.createElement('script')))</script>
<script src="popup.js"></script>
<script src="script.js"></script>
<script type="module" src="index.js"></script>
</body>
</html>
